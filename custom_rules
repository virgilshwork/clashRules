#####################################################
# 在VARn位置插入文本
#####################################################
VAR1='LocalAreaNetwork.list'
cat >VAR1<<- 'EOF'
ruleset=Ⓜ️ 加密货币,https://raw.githubusercontent.com/virgilshwork/clashrule/main/cryptoAll.list
ruleset=Ⓜ️ 挖矿专区,https://raw.githubusercontent.com/virgilshwork/clashrule/main/cryptoMinerPool.list
ruleset=Ⓜ️ 特殊指定,https://raw.githubusercontent.com/virgilshwork/clashrule/main/01_special.list
ruleset=Ⓜ️ DenyKids,https://raw.githubusercontent.com/virgilshwork/clashrule/main/01_denykids.list
ruleset=Ⓜ️ VPN,https://raw.githubusercontent.com/virgilshwork/clashrule/main/01_softether.list
ruleset=Ⓜ️ 视频指定,https://raw.githubusercontent.com/virgilshwork/clashrule/main/01_video.list
EOF

VAR2='负载均衡`load-balance`'
cat >VAR2<<- 'EOF'
custom_proxy_group=🏰 常规自动`url-test`(JP|US|KR|SG)``http://www.apple.com/library/test/success.html`300,,50
custom_proxy_group=Ⓜ️ 加密货币`select`[]🔯 故障转移`[]🚀 节点选择`[]♻️ 自动选择`[]🚀 手动切换`[]🇭🇰 香港节点`[]🇯🇵 日本节点`[]🇺🇲 美国节点`[]🇰🇷 韩国节点`[]DIRECT
custom_proxy_group=Ⓜ️ 挖矿专区`select`[]🔯 故障转移`[]🚀 节点选择`[]♻️ 自动选择`[]🚀 手动切换`[]DIRECT`[]🇯🇵 日本节点
custom_proxy_group=Ⓜ️ 特殊指定`select`[]🚀 节点选择`[]♻️ 自动选择`[]🚀 手动切换`[]🇭🇰 香港节点`[]🇯🇵 日本节点`[]🇺🇲 美国节点`[]🇰🇷 韩国节点`[]DIRECT
custom_proxy_group=Ⓜ️ DenyKids`select`[]PASS`[]DIRECT`[]REJECT
custom_proxy_group=Ⓜ️ VPN`select`[]PASS`[]DIRECT`[]REJECT
custom_proxy_group=Ⓜ️ 视频指定`select`[]🔯 故障转移`[]🚀 节点选择`[]♻️ 自动选择`[]🚀 手动切换`[]🇭🇰 香港节点`[]🇯🇵 日本节点`[]🇺🇲 美国节点`[]🇰🇷 韩国节点`[]DIRECT
EOF

#####################################################
# 替换文本，2行一组。
#####################################################
cat >replaceText<<- 'EOF'
select`[]REJECT`[]DIRECT
select`[]PASS`[]DIRECT`[]REJECT
漏网之鱼`select`[]🚀 节点选择`[]♻️ 自动选择`[]DIRECT
漏网之鱼`select`[]DIRECT`[]PASS`[]🚀 节点选择`[]♻️ 自动选择
游戏平台`select`[]DIRECT`[]🚀 节点选择
游戏平台`select`[]🚀 节点选择`[]DIRECT
♻️ 自动选择`[]
♻️ 自动选择`[]🏰 常规自动`[]
奈飞视频`select`[]🎥 奈飞节点`[]🚀 节点选择
奈飞视频`select`[]🚀 节点选择
custom_proxy_group=🎥 奈飞节点
;custom_proxy_group=🎥 奈飞节点
custom_proxy_group=🇨🇳 台湾节点
;custom_proxy_group=🇨🇳 台湾节点
ruleset=📺 哔哩哔哩
;ruleset=📺 哔哩哔哩
ruleset=🌏 国内媒体
;ruleset=🌏 国内媒体
custom_proxy_group=📺 哔哩哔哩
;custom_proxy_group=📺 哔哩哔哩
custom_proxy_group=🌏 国内媒体
;custom_proxy_group=🌏 国内媒体
ruleset=📺 巴哈姆特
;ruleset=📺 巴哈姆特
custom_proxy_group=📺 巴哈姆特
;custom_proxy_group=📺 巴哈姆特
ruleset=🎶 网易音乐
;ruleset=🎶 网易音乐
custom_proxy_group=🎶 网易音乐
;custom_proxy_group=🎶 网易音乐
http://www.gstatic.com/generate_204`300,,50
http://www.apple.com/library/test/success.html`300,,50
ruleset=🎯 全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaDomain.list
;ruleset=🎯 全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaDomain.list
ruleset=🎯 全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaCompanyIp.list
;ruleset=🎯 全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaCompanyIp.list
ruleset=🎯 全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Download.list
;ruleset=🎯 全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Download.list
EOF

#####################################################
# 抓取ACL4SSR_Online_Full_MultiMode
#####################################################
curl https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/config/ACL4SSR_Online_Full_MultiMode.ini > virgil.ini

#####################################################
# 执行插入指令
#####################################################
sed -i "/$VAR1/r VAR1" virgil.ini
sed -i "/$VAR2/r VAR2" virgil.ini

#####################################################
# 执行替换指令
#####################################################
checkPoint=0
fromText=""
cat replaceText|while read line
do
  line=${line//\//\\/}
  if [ $checkPoint -eq "0" ]; then
        fromText=$line
        checkPoint=1
  else
        sed -i "s/${fromText//\[/\\[}/${line//\[/\\[}/g" virgil.ini
        checkPoint=0
  fi
done
